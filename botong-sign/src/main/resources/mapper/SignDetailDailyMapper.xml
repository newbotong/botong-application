<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yunjing.sign.dao.mapper.SignDetailDailyMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.yunjing.sign.beans.vo.SignUserInfoVO">
        <result column="user_id" property="userId" />
    </resultMap>


    <select id="getCountInfo" resultMap="BaseResultMap">
        select de.user_id
        from sign_detail_daily de
        where de.user_id in (${userIds}) and de.create_time >= #{startDate} and de.create_time <![CDATA[ < ]]> #{startEnd}
    </select>

    <resultMap id="SignDetailResultMap" type="com.yunjing.sign.beans.vo.SignDetailVO">
        <result column="user_id" property="userId" />
        <result column="sign_date" property="signDate" />
        <result column="address_title" property="addressTitle" />
        <result column="address" property="address" />
        <result column="imgs" property="imgUrls" />

    </resultMap>

    <select id="queryMonthInfo" resultMap="SignDetailResultMap">
       SELECT
            de.user_id,
            de.address,
            de.address_title,
            de.create_time as sign_date,
            group_concat(img.url) AS imgs
        FROM
            sign_detail_daily de
        LEFT JOIN sign_detail_img_daily img ON img.sign_detail_id = de.id
        where de.is_delete = 0 and de.user_id = #{userId} and de.create_time >= #{startDate} and de.create_time <![CDATA[ < ]]> #{endDate}
        GROUP BY
            de.user_id,
            de.address,
            de.address_title,
            de.create_time
    </select>
</mapper>
